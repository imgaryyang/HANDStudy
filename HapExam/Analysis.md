# HAP考核
## 需求

### 1.前提准备
```
1．数据库表创建在HAP_DEV模式下，即HAP_DEV用户下
2．序列创建在HAP_DEV模式下，即HAP_DEV用户下
3．索引创建在HAP_DEV模式下，即HAP_DEV用户下
4．开发中所有的页面标签、消息均支持多语言
5．除了框架所需要的字段以及主键自增长,禁止修改数据库表结构
```

### 2.开发列表
```
“销售订单管理”功能，主要包括销售订单汇总页面及明细页面
	1．销售订单汇总查询页面
	2．录入、编辑、查看销售订单页面
	3．导出销售订单信息至Excel（选做）
	4．销售订单单据报表打印（选做）
	5．按钮权限控制
```

### 3.功能设置
```
1.角色：新建两个角色，销售员、销售经理
2.功能：新建一个功能，销售订单管理
3.把销售订单功能挂到“销售员”、“销售经理”角色下
4.订单状态代码维护
```

- 订单状态维护约定
```
代码：HAP_OM_ORDER_STATUS
描述：销售订单状态
值/含义：
		NEW/新建,
		SUBMITED/已提交,
		APPROVED/已审批,
		REJECTED/已拒绝
```


### 4. 数据库搭建
#### 4.1 主数据表
```
公司主数据：HAP_ORG_COMPANYS
	主键:COMPANY_ID

客户主数据：HAP_AR_CUSTOMERS
	主键:CUSTOMER_ID

物料主数据：HAP_INV_INVENTORY_ITEMS
	主键:INVENTORY_ITEM_ID
```

#### 4.2 业务数据表
```
销售订单头信息:HAP_OM _ORDER_HEADERS
	主键:HEADER_ID
	要求:HAP_OM_ORDER_HEADER _S	从1000开始

销售订单行信息:HAP_OM _ORDER_LINES
	主键:LINE_ID
	要求:HAP_OM _ORDER_LINES_S	从1000开始
```

#### 4.3 数据库额外的补充设置
```
ALTER TABLE `hap_om_order_headers` ADD PRIMARY KEY ( `HEADER_ID` ) 

ALTER TABLE `HAP _OM_ORDER_LINES` ADD PRIMARY KEY ( `LINE_ID` ) 

ALTER TABLE hap_om_order_headers AUTO_INCREMENT = 1000

ALTER TABLE hap_om_order_lines AUTO_INCREMENT = 1000
```


### 5. 销售订单汇总页面
#### 5.1 实现功能
```
1.实现多条件查询销售订单
2.通过订单编号点击查看或编辑销售订单
3.实现“新增”按钮跳转销售订单明细界面进行订单录入
4.实现Excel导出销售订单数据
```

#### 5.2 界面设计及功能实现
![](https://img2018.cnblogs.com/blog/1231979/201904/1231979-20190420090953854-1660540996.png)



#### 5.3.单独功能具体实现要求
##### 5.3.1 基于查询公司、客户、销售订单号、物料、订单状态查询销售订单数据

- 1.公司名称
```
	LOV,显示公司名称,基于公司ID进行关联查询
	
	LOV样式
		第一列公司代码,第二列公司名称
```

- 2.客户名称
```
	LOV,显示客户名称,基于客户ID进行关联查询,其中如果选择了公司，客户LOV必须使用公司选定值进行限定.


	LOV样式
		第一列客户编码,第二列客户名称
```

- 3.销售订单号,普通文本字段

- 4.物料
```
	LOV,显示物料描述,基于物料ID进行关联查询

	LOV样式
		第一列物料编码,第二列物料描述
```

- 5.订单状态
```
	1.订单状态，下拉列表，显示描述，基于代码值进行关联查询，主要来源表SYS_CODE_B,SYS_CODE_TL,SYS_CODE_VALUE_B,SYS_CODE_VALUE_TL，需要保证数据的有效性及多语言
```


- 6.进行数据查询
```
	1.根据选定的查询条件查询相关的订单信息,显示字段如图Grid所示，主要信息包括：销售订单号、公司名称、客户名称、订单日期、订单状态、订单金额

	2.查询出来的数据只能查看，不能编辑修改
	
	3.点击销售订单号可进入到销售订单明细界面进行查看或修改 
```

##### 5.3.2 导出订单数据(基于Excel)
```
根据查询框的筛选条件，在点击“导出Excel” 按钮时导出数据至Excel文档
```

##### 5.3.3 点击新建按钮进行订单录入
```
点击“新建”按钮 跳转到订单明细界面进行订单录入操作
```

### 6.销售订单明细页面
#### 6.1 实现功能
```
1.实现新增/更改/查看销售订单，禁止销售订单被删除
2.根据单据状态对页面进行控制（选做）
3.实现销售订单单据报表打印功能（选做）
4.基于配置设置控制按钮权限（选做）
5.实现多Tab页签功能
```

#### 6.2 界面设计及功能实现
- 主要界面设置
![](https://img2018.cnblogs.com/blog/1231979/201904/1231979-20190420092712039-48644870.png)

- 其他页面设置
![](https://img2018.cnblogs.com/blog/1231979/201904/1231979-20190420092820360-1467306751.png)

>注意：界面中灰色字段为不可更新字段，黄色为必输字段。


- 主要信息包括
```
	订单头信息：公司名称、客户名称、订单编号、订单日期、订单状态、订单总金额等。
	订单行信息：行号、物料编号、物料描述、数量、单位、销售单价、金额、附加信息
```
![](https://img2018.cnblogs.com/blog/1231979/201904/1231979-20190420093349400-1433442284.png)

>这里的状态控制是整体的控制逻辑，针对具体按钮的附加控制逻辑下文“按钮控制逻辑”小节




#### 6.3 新增订单时的字段初始值：
```
1）订单日期：默认为当前日期;
2）订单状态：NEW（新建）状态.
4）订单行的行号:等于当前订单的最大行号 + 1.
5）提交、审批、拒绝、整单删除、单据打印按钮不可用
```



### 6.4 订单头数据
- 公司名称
```
	必输字段,使用LOV选择,主要来源表HAP_ORG_COMPANYS,需要保证数据的有效性.后台保存公司ID
```

- 客户名称：
```
	必输字段,使用LOV选择,主要来源表HAP_AR_CUSTOMERS,需要保证数据的有效性,另外必须使用公司选定值进行限定（选择了公司,才能选到客户）
	
	LOV样式:
		第一列客户编码，第二列客户名称
```


- 订单编号:必输字段,文本
- 订单日期
```
	必输字段,使用日历选择窗体来选择,要求日历窗口只能选择2016年后的日期
```

- 订单状态
```
通过相关按钮来控制对应的状态，值有
		NEW		新建
	SUBMITED	已提交
	APPROVED	已审批
	REJECTED	已拒绝
```

- 订单总金额
```
	为订单行金额的汇总,同时保留2位小数,如：999.99
```

- 行号
```
	但必须保证输入的序号是唯一的,默认带出当前订单最大行号+1
```


- 物料编码
```
	必输字段,使用LOV,来源表HAP_INV_INVENTORY_ITEMS,选择能用于销售的物料数据并保证数据的有效性
```

- 物料描述
```
不可更改，选择物料编码后带出
```

