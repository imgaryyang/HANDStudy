## Redis面试题
### Redis 有什么优点?
- 速度快：数据存储在内存中，类似于HashMap，操作和查找的时间复杂度都是 O(1)
- 支持数据类型丰富：有字符串string，字段hash，列表list，集合Set，有序集合zSet
- 支持持久化


### Redis有什么缺点
- 存储受内存大小限制
- 持久化时占用Cpu较高


### 为什么Redis 单线程的效率高
- 1.操作的内存，本身速度快
- 2.使用单线程，避免了上下文切换


### Redis有几种持久化方式?
**有全量RDB持久化和增量AOF持久化**
- 1.全量RDB持久化，在指定时间，fork一个子进程，将数据写入到临时文件，完成后替换之前的文件，用二进制压缩存储。
	- 1.1可以灵活设置备份拼了吧和周期，适合冷备份，恢复快，性能最大化。
	- 1.2 在完成持久化之前宕机，会丢失数据；fork子进程占用资源。
- 2.增量AOP持久化，讲咩一个非读操作，记录到文件中，使用操作恢复。
	- 2.1 使用追击模式，不会影响以前的数据；丢失数据量少；文件过大会重写压缩；生成的文件格式清晰，易于理解；
	- 生成的文件要大，恢复速度慢于RDB；运行效率低于RDB；操作回放更加脆弱。



### 如何从一亿个key中找到以某个固定前缀开头的key？
- 使用keys 指令，匹配固定前缀；
- 可以使用scan 指令，但是可能有一定的重复，需要客户端去重，划分时间。


### Redis如何实现分布式锁?
- 使用setnx来争抢锁，再用expire加一个过期时间，防止忘记释放锁；

- 如果在执行setnx 之后，expire之前发生异常，就会死锁；可以将setnx和expire 合成一条指令；


### Redis如何做队列?
- list是双端操作的，可使用list作为队列一段作为生产者入队rpush，另一端作为消费者出队lpop；
- 实现延迟队列，可以使用zortedset，使用时间作为score，zadd生产消息，zrangbyscore指定获取描述的数据。
- 如何生产一次，消费多少次？可以使用发布订阅模式；缺点是消费者下线，消息会丢失。


### 如果大量的key 在同一时间过期，需要注意什么?
**过期时间过于集中，可能会出现短暂卡顿，可加一个随机值，使用过期时间分散一些**


### 什么是缓存穿透?如何解决?
```
查询一个一定不存在的数据,缓存中不存在,则会去数据库中查询,数据库中不能存在则不会写入缓存,这导致每次查询都会查询数据库,使缓存失去意义.

可以使用空对象,当查询为空时设置一个特殊的值,和真正合法数据区分开,要有一个较短的过期时间.

使用过滤器,先查缓存,缓存中存在key则返回;不存在则查询过滤器,过滤器存在则说明不存在值,直接返回空,否则查询数据库
```


### 什么是缓存雪崩?如何解决?
```
缓存无法使用导致请求全部到达数据库,导致数据库崩溃;

缓存高可用,减少缓存不可用时间;

数据库限流;

服务降级;
```

### 什么是缓存击穿?如何解决
```
某个key失效时,大量的请求进入,将数据库瞬间压垮.

使用锁,确保只有一个线程去查询数据库,手动过期,不设置过期时间,所有key手动过期
```


### redis 默认有多少数据库,如何指定?
```
默认有16个数据库,下表默认从0开始。可以通过配置database选项指定。

可以通过select 下标 切换数据库
```


### 过期键删除策略?
- 主动删除：
	- 定时删除：创建定时器，在键过期的时侯，删除键;占用cpu。
	- 定期删除：每隔一段时间，删除过期键。

- 被动删除
	- 惰性删除：在取出键的时候检查是否过期；有些键不被使用，永远无法删除


### save 和 bgsave 的区别?
```
save:由于redis是单线程的，save会造成阻塞，在rdb文件创建完成期键不处理任何请求。

bgsave：会创建子线程，完成rdb文件的创建工作,主线程正常执行。


在执行bgsave期间,主线程会拒绝save和bgsave命令;bgrewritteaof 命令会延迟bgsave 命令结束之后执行
```

### 旧版Redis 复制过程是怎样的?
```
同步
	从服务器向主服务器发送sync指令
	主服务器收到sync命令,执行 bgsave ，生成rdb 文件，并使用一个缓存区记录备份开始后 执行的所有命令。
	主服务器bgsave执行完成后,将rdb 文件发送给从服务器，从服务器接受rdb文件并载入
	主服务器将缓冲区中的所有写命令发送给从服务器,从服务器执行命令

命令传播
	主服务器会将自己的写命令同步给从服务器,从服务器执行命令
```

### 新版复制过程如何解决问题
```
新本复制psync 分为完成重同步和部分重同步。

完成重同步和sync 的同步过程一致

部分重同步用于断线情况，主服务器只将断线期间的写命令发送给从服务器执行
```