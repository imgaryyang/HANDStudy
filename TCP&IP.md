## 对于TCP/IP协议的三次握手和四次挥手的理解

### TCP报文首部格式的几个名词
#### 序列号seq
占4个字节，用来标记数据段的顺序，TCP把连接中发送的所有数据字节都编上一个序号，第一个字节的编码由本地随机产生；给字节编上序号后，就给每一个报文指派一个序号；序列号seq就是这个报文段中的第一个字节的数据编号。


#### 确认号ack
占1位，仅当ACK = 1 时，确认号字段才有效。ACK=0时，确认号无效

#### 同步SYN
连接建立时用于同步序号。当SYN=1，ACK=0时表示：这是一个连接请求报文段。若同意连接，则在响应报文段中使得SYN=1，ACK=1。因此，SYN=1表示这是一个连接请求，或连接接受报文。SYN这个标志位只有在TCP建产连接时才会被置1，握手完成后SYN标志位被置0。


#### 终止FIN
用来释放一个连接。FIN=1表示：此报文段的发送方的数据已经发送完毕，并要求释放运输连接

>ACK、SYN和FIN这些大写的单词表示标志位，其值要么是1，要么是0；ack、seq小写的单词表示序号。

### 三次握手过程
#### 三次握手图片教程
![](https://img2018.cnblogs.com/blog/1231979/201912/1231979-20191202211548564-1903753409.png)


#### 三次握手的文字过程

- 主机A向主机B发送给TCP连接请求数据包，其中包含主机A的初始序列号seq(A) = x (其中报文中同步标志位SYN = 1，ACK=0，表示这是一个TCP连接请求数据报文；序号seq=1，表明传输数据时的第一个数据字节的序号是x)
- 主机B收到请求后，会发回连接确认数据包。(其中确认报文段中，标识位SYN = 1，ACK=1，表示这是一个TCP连接响应数据报文，包含主机B的初始序列号seq(B)=y,以及主机B对主机A初始序列号的确认号ack(B)=seq(A)=x+1)
- 第三次，主机A收到主机B的确认报文后，还需作出确认，即发送一个序列号seq(A)=x+1；确认号为ack(A)=y+1的报文；


### 四次挥手过程
#### 四次挥手的图片过程
![](https://img2018.cnblogs.com/blog/1231979/201912/1231979-20191202225042492-1953229412.png)


#### 四次挥手的文字过程
- 第一次挥手：Client发送一个FIN，用来关闭Client到Server的数据传送，Client进入FIN_WAIT_1状态。
- 第二次挥手：Server收到FIN后，发送一个ACK给Client，确认序号为收到序号+1（与SYN相同，一个FIN占用一个序号），Server进入CLOSE_WAIT状态。
- 第三次挥手：Server发送一个FIN，用来关闭Server到Client的数据传送，Server进入LAST_ACK状态。
- 第四次挥手：Client收到FIN后，Client进入TIME_WAIT状态，接着发送一个ACK给Server，确认序号为收到序号+1，Server进入CLOSED状态，完成四次挥手，连接关闭